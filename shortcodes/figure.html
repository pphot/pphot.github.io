<figure class="image-with-caption {{ default .align "center" }}" style="display: flex; flex-direction: column; align-items: {{ if eq .align "left" }}flex-start{{ else if eq .align "right" }}flex-end{{ else }}center{{ end }}; margin: {{ default .margin "2rem 0" }}; {{ if .width }}max-width: {{ .width }};{{ end }}">{{ if .src }}<img src="{{ .src }}" alt="{{ .alt }}" {{ if .width }}width="{{ .width }}"{{ end }} {{ if .height }}height="{{ .height }}"{{ end }} loading="{{ default .loading "lazy" }}" decoding="async" style="{{ if eq .size "small" }}max-width: 400px;{{ else if eq .size "medium" }}max-width: 700px;{{ else if eq .size "large" }}max-width: 100%;{{ else }}{{ end }}">{{ end }}{{ if .caption }}<figcaption style="margin-top: 0.5rem; font-size: 0.9rem; color: #666; font-style: italic; text-align: {{ if eq .align "left" }}left{{ else if eq .align "right" }}right{{ else }}center{{ end }};">{{ .caption }}</figcaption>{{ end }}</figure>